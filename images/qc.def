Bootstrap: debootstrap
OSVersion: bionic
MirrorURL: http://us.archive.ubuntu.com/ubuntu/

%help
    echo "This is the Quality Control (QC) Singularity container for use in the FungiFlow pipeline"
    echo "This is version 1 of this singularity container"
    echo "This image contains the following software:"
    echo " - FastQC"
    echo " - Falco"
    echo " - MultiQC"
    echo " - Trimmomatic"
    echo " - Quast"

%files
    /home/kelly/Desktop/Singularity/files/adap_ID.sh /adap_ID.sh
    /home/kelly/Desktop/Singularity/files/TruSeq3-PE-2.fa /TruSeq3-PE-2.fa

%startscript
    echo "FungiFlow Quality Control Singularity Container"
    echo "Container version: 1"
    python --version
    
%post
    # installing prerequisites
    cat /etc/apt/sources.list
    sed -i 's/$/ universe/' /etc/apt/sources.list
    apt-get update
    apt-get install -y apt-utils dialog locales wget python3 python3-setuptools unzip \
    trimmomatic openjdk-11-jdk openjdk-11-jre python3-pip zlib1g zlib1g-dev pkg-config \
    libfreetype6-dev libpng-dev libexpat1-dev python3-matplotlib git build-essential fastqc   
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    
    # installing Falco
    wget https://github.com/smithlabcode/falco/releases/download/v0.2.1/falco-0.2.1.tar.gz
    tar -xzvf falco*
    cd falco-0.2.1
    ./configure CXXFLAGS="-O3 -Wall"
    make all
    make install
    cd /
    
    # installing MultiQC
    pip3 install multiqc

    # installing QUAST
    git clone https://github.com/ablab/quast.git \
    && cd quast \
    && python3 setup.py install_full
    cd /
    export PATH=/quast/:$PATH
    
    apt-get clean \
    && rm -rf /var/lib/apt/lists/
  
%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    export PATH=/FastQC:$PATH
    export PATH=/quast/:$PATH
    export PATH=/:$PATH

%labels
    Version: 1
    Maintainer "Kelly Styles" <kelly.styles@vuw.ac.nz>

