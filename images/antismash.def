Bootstrap: library
From: ubuntu:18.04

%help
    echo "This is a singularity image containing antiSMASH5.1"
    echo "antiSMASH is in /antismash-5.1.0/"
    echo "databases are in /antismash-5.1.0/antismash/databases"
    echo "running antismash --help-showall"
    python3 run_antismash.py --help-showall

%post
# installing prerequisites not specified by antiSMASH install instructions
    sed -i 's/$/ universe/' /etc/apt/sources.list
    apt-get update
    apt-get install -y apt-utils dialog locales vim wget python-pip python3-setuptools gnupg openjdk-11-jre
    locale-gen en_NZ.UTF-8
    export LC_ALL=en_NZ.UTF-8
# antiSMASH install
    apt-get update
    apt-get install -y apt-transport-https
    wget http://dl.secondarymetabolites.org/antismash-stretch.list -O /etc/apt/sources.list.d/antismash.list
    wget -q -O- http://dl.secondarymetabolites.org/antismash.asc | apt-key add -
    apt-get update
    apt-get install -y hmmer2 hmmer diamond-aligner fasttree prodigal ncbi-blast+ muscle glimmerhmm meme-suite
    wget https://dl.secondarymetabolites.org/releases/5.1.0/antismash-5.1.0.tar.gz -O /antismash-5.1.0.tar.gz
    tar -zxf /antismash-5.1.0.tar.gz
    cd /antismash-5.1.0
    python3 setup.py install
    python3 antismash/download_databases.py --database-dir /antismash-5.1.0/antismash/databases
    chmod -R 777 /antismash-5.1.0/

%environment
    export LC_ALL=en_NZ.UTF-8
    export PATH=/antismash-5.1.0:$PATH
    export PATH=/antismash-5.1.0/antismash:$PATH

%runscript
    echo "This is a singularity image containing antiSMASH5.1"
    echo "antiSMASH is in /antismash-5.1.0/"
    echo "databases are in /antismash-5.1.0/antismash/databases"
    echo "running antismash --help-showall"
    python3 run_antismash.py --help-showall

%test
    echo "Running antismash --check-prereqs"
    export LC_ALL=en_NZ.UTF-8
    export PATH=/antismash-5.1.0:$PATH
    export PATH=/antismash-5.1.0/antismash:$PATH
    python3 /antismash-5.1.0/run_antismash.py --check-prereqs

%labels
    Maintainer "Vincent Nowak <vincent.nowak@vuw.ac.nz>"

