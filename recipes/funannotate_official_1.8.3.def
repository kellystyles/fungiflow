Bootstrap: docker
From: nextgenusfs/funannotate

%files
    /home/kelly/Downloads/gmes_linux_64_4.tar.gz
    /home/kelly/Downloads/gm_key_64.gz

%post
    cat /etc/apt/sources.list
    sed -i 's/$/ universe/' /etc/apt/sources.list
    export LC_ALL=C
    export LANG=C
    apt update && apt install -y perl make cpanminus gcc dialog wget python3 libconfig-yaml-perl
    python3 -m ensurepip --upgrade

    # Perl modules installation
    cpanm YAML Hash::Merge Logger::Simple Parallel::ForkManager

    # GeneMark install
    tar -xvzf /home/kelly/Downloads/gmes_linux_64_4.tar.gz -C /venv/bin/
    mv /venv/bin/gmes_linux_64_4/ /venv/bin/gmes_linux_64/
    export GENEMARK_PATH="/venv/bin/gmes_linux_64/" >> ~/.bashrc
    export PATH="/venv/bin/gmes_linux_64/":$PATH >> ~/.bashrc
    gunzip -c /home/kelly/Downloads/gm_key_64.gz > ~/.gm_key
    cd /venv/bin/gmes_linux_64/
    ./change_path_in_perl_scripts.pl /venv/bin/perl
    mkdir GeneMark-E-tests/EP/test && cd GeneMark-E-tests/EP/test
    ../../../gmes_petap.pl --seq ../input/genome.fasta --EP --dbep ../input/proteins.fasta --verbose --cores=8 --max_intergenic 10000 --mask_penalty 0
    cd .. && rm -r test

    # EggNOG-mapper install
    pip3 install eggnog-mapper

%environment
    export PATH="/venv/bin/gmes_linux_64/":$PATH >> ~/.bashrc
    export GENEMARK_PATH="/venv/bin/gmes_linux_64/" >> ~/.bashrc

%test
    export GENEMARK_PATH="/venv/bin/gmes_linux_64/"
    echo "Software versions:"
    funannotate --version
    gmes_petap.pl --version
    emapper.py --version

%help
    Built from Docker Hub nextgenusfs/funannotate